<!DOCTYPE html>
<html>
<head>
    <title>Relatório Inteligente</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">
<div class="container py-5">
    <h1 class="text-center mb-4">Relatório Inteligente</h1>

    <div class="card p-4 shadow-sm mb-4">
        <h2>Preview CSV</h2>
        {{ preview|safe }}
    </div>

    <div class="card p-4 shadow-sm mb-4">
        <h2>Estatísticas</h2>
        <canvas id="statsChart" width="400" height="200"></canvas>
    </div>

    <div class="card p-4 shadow-sm mb-4">
        <h2>Insights</h2>
        <ul>
            {% for i in insights %}
            <li>{{ i }}</li>
            {% endfor %}
        </ul>
    </div>

    <a href="/" class="btn btn-primary w-100">Voltar</a>
</div>

<script>
const ctx = document.getElementById('statsChart').getContext('2d');
const data = {
    labels: {{ numeric_cols|tojson }},
    datasets: [{
        label: 'Total por tipo de falta',
        data: {{ numeric_cols|map('attribute', 'total')|list|tojson }},
        backgroundColor: ['#007bff','#28a745','#ffc107','#dc3545','#17a2b8']
    }]
};
const statsChart = new Chart(ctx, { type: 'bar', data });
</script>
</body>
</html>
